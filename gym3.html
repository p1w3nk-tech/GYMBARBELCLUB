<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Manajemen Member & Pembayaran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    :root { --gap: 10px; }
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f8fa; }
    h2 { margin: 0 0 16px; }
    nav { display: flex; flex-wrap: wrap; gap: var(--gap); margin-bottom: 16px; }
    button { padding: 8px 12px; cursor: pointer; border-radius: 8px; border: 1px solid #aaa; background: #e3f2fd; }
    button:hover { background: #bbdefb; }
    .tabs > div { display: none; padding: 12px; border-radius: 8px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .tabs > div.active { display: block; }
    input, select { padding: 6px 8px; border: 1px solid #bbb; border-radius: 6px; }
    form { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--gap); align-items: end; }
    form button[type="submit"] { grid-column: 1 / -1; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: #fff; }
    th, td { border: 1px solid #aaa; padding: 6px; text-align: left; }
    th { background: #90caf9; color: #0d47a1; }
    td.center { text-align: center; }
    .toolbar { display: flex; gap: var(--gap); flex-wrap: wrap; margin: 8px 0 12px; }
    .muted { color: #666; font-size: 12px; }
    input[type="checkbox"] { transform: scale(1.2); accent-color: #0d47a1; }

    @media print {
      nav, .no-print, form, .muted { display: none !important; }
      body { margin: 0.5cm; background: #fff; }
      table { page-break-inside: avoid; }
      th, td { font-size: 11px; }
    }
  </style>
</head>
<body>
  <h2>ðŸ“‹ Sistem Member & Pembayaran</h2>

  <!-- LOGIN -->
  <div id="loginBox" class="no-print">
    <h3>Login</h3>
    <label>Username <input type="text" id="username"></label>
    <label>Password <input type="password" id="password"></label>
    <button onclick="login()">Login</button>
  </div>

  <nav class="no-print" id="menu" style="display:none;">
    <button onclick="showTab('tab-member')" class="adminOnly">Database Member</button>
    <button onclick="showTab('tab-payment')" class="adminOnly">Pembayaran</button>
    <button onclick="showTab('tab-report')">Report Rekap</button>
    <button onclick="logout()">Logout</button>
  </nav>

  <div class="tabs">
    <div id="tab-member" class="adminOnly">
      <h3>Database Member</h3>
      <form id="memberForm">
        <input type="hidden" id="editIndexMember" />
        <label>ID<br><input type="text" id="memberID" required /></label>
        <label>Nama<br><input type="text" id="memberName" required /></label>
        <label>Alamat<br><input type="text" id="memberAddress" required /></label>
        <label>No HP<br><input type="text" id="memberPhone" required /></label>
        <button type="submit">Simpan Member</button>
      </form>
      <table id="memberTable">
        <thead><tr><th>ID</th><th>Nama</th><th>Alamat</th><th>No HP</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="tab-payment" class="adminOnly">
      <h3>Pembayaran</h3>
      <form id="paymentForm">
        <label>ID Member<br><input type="text" id="payID" required onblur="fillMemberData()" /></label>
        <label>Nama<br><input type="text" id="payName" readonly /></label>
        <label>Alamat<br><input type="text" id="payAddress" readonly /></label>
        <label>No HP<br><input type="text" id="payPhone" readonly /></label>
        <label>Tahun<br><input type="number" id="payYear" required /></label>
        <label>Bulan<br><input type="number" id="payMonth" min="1" max="12" required /></label>
        <label>Tgl Bayar<br><input type="date" id="payDate" required /></label>
        <button type="submit">Simpan Pembayaran</button>
      </form>
      <table id="paymentTable">
        <thead><tr><th>ID</th><th>Nama</th><th>Alamat</th><th>No HP</th><th>Tahun</th><th>Bulan</th><th>Tgl Bayar</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- TAB: REPORT -->
    <div id="tab-report">
      <h3>Report Rekap (Matrix Janâ€“Des)</h3>
      <div class="toolbar no-print">
        <label>Tahun <input type="number" id="filterYear" placeholder="mis. 2025" /></label>
        <button onclick="generateReport()">Tampilkan</button>
        <button onclick="exportExcel()">Export Excel</button>
        <button onclick="window.print()">Print</button>
      </div>
      <table id="reportTable">
        <thead>
          <tr>
            <th>ID</th><th>Nama</th><th>Alamat</th><th>No HP</th><th>Tahun</th>
            <th>Jan</th><th>Feb</th><th>Mar</th><th>Apr</th><th>Mei</th><th>Jun</th>
            <th>Jul</th><th>Agu</th><th>Sep</th><th>Okt</th><th>Nov</th><th>Des</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="muted">Keterangan: âœ… = Lunas, â€“ = Belum Bayar</div>
    </div>
  </div>

<script>
let members = JSON.parse(localStorage.getItem("members")) || [];
let payments = JSON.parse(localStorage.getItem("payments")) || [];

let isAdmin = false;
function login(){
  const user = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value.trim();
  if(user === "admin" && pass === "wulankwan"){
    isAdmin = true;
    alert("Login berhasil sebagai Admin");
  } else {
    isAdmin = false;
    alert("Login sebagai User (Report saja)");
  }
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("menu").style.display = "flex";
  applyRole();
  showTab("tab-report");
}
function logout(){
  isAdmin = false;
  document.getElementById("menu").style.display = "none";
  document.getElementById("loginBox").style.display = "block";
  showTab("tab-report");
}
function applyRole(){
  document.querySelectorAll(".adminOnly").forEach(el=>{
    el.style.display = isAdmin ? "" : "none";
  });
}

function showTab(id){
  document.querySelectorAll(".tabs > div").forEach(el => el.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function saveMembers(){ localStorage.setItem("members", JSON.stringify(members)); }
function savePayments(){ localStorage.setItem("payments", JSON.stringify(payments)); }

function renderMembers(){
  const tbody = document.querySelector("#memberTable tbody");
  tbody.innerHTML = "";
  members.forEach((m,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${m.id}</td><td>${m.name}</td><td>${m.address}</td><td>${m.phone}</td><td><button onclick="editMember(${i})">Edit</button><button onclick="deleteMember(${i})">Hapus</button></td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById("memberForm").addEventListener("submit", function(e){
  e.preventDefault();
  const id=document.getElementById("memberID").value.trim();
  const data={id,name:memberName.value,address:memberAddress.value,phone:memberPhone.value};
  const idx=members.findIndex(x=>x.id===id);
  if(idx>=0) members[idx]=data; else members.push(data);
  saveMembers(); renderMembers(); this.reset();
});

function editMember(i){
  const m=members[i];
  memberID.value=m.id; memberName.value=m.name; memberAddress.value=m.address; memberPhone.value=m.phone;
  showTab('tab-member');
}
function deleteMember(i){ members.splice(i,1); saveMembers(); renderMembers(); }

function renderPayments(){
  const tbody=document.querySelector("#paymentTable tbody");
  tbody.innerHTML="";
  payments.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.id}</td><td>${p.name}</td><td>${p.address}</td><td>${p.phone}</td><td>${p.year}</td><td>${p.month}</td><td>${p.date}</td><td><button onclick=\"editPayment('${p.id}',${p.year},${p.month})\">Edit</button><button onclick=\"deletePayment('${p.id}',${p.year},${p.month})\">Hapus</button></td>`;
    tbody.appendChild(tr);
  });
}

paymentForm.addEventListener("submit", function(e){
  e.preventDefault();
  const id=payID.value.trim();
  const m=members.find(x=>x.id===id);
  if(!m){alert("ID tidak ada"); return;}
  const data={id,name:m.name,address:m.address,phone:m.phone,year:payYear.value,month:payMonth.value,date:payDate.value};
  const idx=payments.findIndex(x=>x.id===id && x.year==data.year && x.month==data.month);
  if(idx>=0) payments[idx]=data; else payments.push(data);
  savePayments(); renderPayments(); this.reset();
});

function fillMemberData(){
  const m=members.find(x=>x.id===payID.value.trim());
  payName.value=m?m.name:""; payAddress.value=m?m.address:""; payPhone.value=m?m.phone:"";
}
function editPayment(id,year,month){
  const p=payments.find(x=>x.id===id && x.year==year && x.month==month);
  if(!p) return;
  payID.value=p.id; payName.value=p.name; payAddress.value=p.address; payPhone.value=p.phone;
  payYear.value=p.year; payMonth.value=p.month; payDate.value=p.date;
  showTab('tab-payment');
}
function deletePayment(id,year,month){ payments=payments.filter(p=>!(p.id===id && p.year==year && p.month==month)); savePayments(); renderPayments(); }

function generateReport(){
  const year=Number(filterYear.value); const tbody=document.querySelector("#reportTable tbody"); tbody.innerHTML="";
  if(!year){ alert("Masukkan Tahun terlebih dahulu!"); return; }
  const paid=new Set(payments.filter(p=>Number(p.year)===year).map(p=>`${p.id}|${p.year}|${p.month}`));
  members.forEach(m=>{
    let html=`<td>${m.id}</td><td>${m.name}</td><td>${m.address}</td><td>${m.phone}</td><td>${year}</td>`;
    for(let i=1;i<=12;i++){
      const checked=paid.has(`${m.id}|${year}|${i}`)?"checked":"";
      html+=`<td class='center'><input type='checkbox' ${checked} disabled></td>`;
    }
    const tr=document.createElement("tr"); tr.innerHTML=html; tbody.appendChild(tr);
  });
}

function exportExcel(){ const wb=XLSX.utils.table_to_book(reportTable,{sheet:"Report"}); XLSX.writeFile(wb,"Report.xlsx"); }

renderMembers(); renderPayments();
</script>
</body>
</html>